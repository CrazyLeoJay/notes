# SDK 自动打包构建服务

## 目的

将反编译构建APK的过程，从手动构建升级为自动构建，并且部署在服务器上，提交任务可以自动构建并且通过指定链接返回结果。

## 资源

> 除了基础的Apk资源包，其他包都是可选的，根据需求场景不同，设计时都有侧重。 
>
> - 如果要提高效率，那么就可以通过空间换时间的方式，存储可复用的资源，多次利用。
> - 如果需要节省空间，那么就保留基础参数，每次都是从头反编译、合并、写参、构建。

### 基础-渠道Apk资源包

渠道资源包是指接入了手游SDK，并且针对不同渠道进行插件配置的专属Apk包。比如（举例）：

- 普通包（没有接入）：仅仅接入了手游SDK的渠道包，一般用于和第三方合作，或者一些没有限制平台的场景。
- 华为包（应用市场）：就是指在接入手游SDK基础上，接入了华为APP-Gallery SDK；这个包是使用的华为的登录体系，但需要通过手游SDK提供游戏服务。
- 爱奇艺（媒体上报）：在接入手游SDK基础上，增加iqiyi SDK，登录注册付费等功能使用手游SDK提供，但产生游戏行为数据时，需要同步上报数据给媒体方。
- 穿山甲（激励广告）：这种包时可以跟上面不同渠道进行组合，根据需求判断是否启用。

根据需求不同，会产生各种各样的渠道Apk包，所以在设计SDK框架时，也要在这方面进行考虑。最好是可以通过CICD，自动化批量构建，并且在代码更新时同步更新构建。

这里建议使用Jenkins，有非常多插件可以使用。Jenkins还提供了对外的API，可以通过接口创建渠道包构建项目，建立一个构建并上传的的项目后，通过API获取其配置，后续有新增渠道时，可以以这个为模板，通过接口去创建新的构建项目。并且可以做一个后台去维护它，可以实现自动化构建项目的配置维护。从而实现渠道自动化构建。

### 基础-第三方APK资源包

这里一般指游戏方接入了我们提供的SDK的游戏Apk文件。游戏一般是只需要接入一次。更新频率相比于SDK低很多，由于游戏接入了SDK，所以只需要保证SDK接口一致，具体的实现通过构建脚本进行更新即可。

### 基础-渠道构建参数

在[构建脚本](build-shell)中参数配置有提到参数物料管理。其实可以将这个功能设计进入这个服务，一方面可以给本服务的资源构建提供数据支持，同时还可以给本地构建提供支持，另一方面，如果数据来源方式比较分散，可以将各个数据源的数据汇总，然后输出统一的格式。





### 渠道合并资源包

> 合并后还未构建的资源源文件。



### 构建成功的Apk资源。



## 服务设计



## 单点部署设计



## 多服务器部署设计（极尽资源！）

