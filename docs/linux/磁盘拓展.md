# 虚拟机Linux磁盘拓展
## 背景

系统是：Ubuntu24.04

```bash
 #df -h
	Filesystem                         Size  Used Avail Use% Mounted on
	tmpfs                              392M  1.4M  391M   1% /run
	efivarfs                           256K   41K  211K  17% /sys/firmware/efi/efivars
	/dev/mapper/ubuntu--vg-ubuntu--lv  193G  192G     0 100% /
	tmpfs                              2.0G     0  2.0G   0% /dev/shm
	tmpfs                              5.0M     0  5.0M   0% /run/lock
	/dev/sda2                          2.0G  192M  1.6G  11% /boot
	/dev/sda1                          1.1G  6.2M  1.1G   1% /boot/efi
	tmpfs                              392M   16K  392M   1% /run/user/1000
```

拓展后：

```sh
~$ df -h
Filesystem                         Size  Used Avail Use% Mounted on
tmpfs                              392M  1.4M  391M   1% /run
efivarfs                           256K   41K  211K  17% /sys/firmware/efi/efivars
/dev/mapper/ubuntu--vg-ubuntu--lv  489G  192G  275G  42% /
tmpfs                              2.0G     0  2.0G   0% /dev/shm
tmpfs                              5.0M     0  5.0M   0% /run/lock
/dev/sda2                          2.0G  192M  1.6G  11% /boot
/dev/sda1                          1.1G  6.2M  1.1G   1% /boot/efi
tmpfs                              392M   16K  392M   1% /run/user/1000
```







看到您的虚拟机磁盘已扩展到500GB，但系统内的逻辑卷仍只有193G。以下是扩展系统中磁盘的完整步骤：

## 1. 检查当前磁盘分区情况
```bash
sudo fdisk -l /dev/sda
```
您应该能看到磁盘总容量为500GB，但分区可能还没有扩展到整个空间。

## 2. 扩展分区（如果使用MBR分区表）
```bash
# 测试有效，有命令行类图形界面操作，比较方便
sudo cfdisk /dev/sda
# 或者使用parted
sudo parted /dev/sda
```
在parted中：
```bash
print
resizepart 3 100%  # 假设LVM在分区3上，根据实际情况调整
quit
```

## 3. 重新扫描磁盘
```bash
sudo partprobe /dev/sda
```

## 4. 扩展物理卷（PV）
```bash
# 根据实际分区调整
# 测试有效，将磁盘分区拓展成功
sudo pvresize /dev/sda3
```

## 5. 检查卷组（VG）空间
```bash
sudo vgdisplay ubuntu-vg
```

## 6. 扩展逻辑卷（LV）
```bash
# 不知道有没有起作用
sudo lvextend -l +100%FREE /dev/mapper/ubuntu--vg-ubuntu--lv
```

## 7. 扩展文件系统
```bash
# 对于ext4文件系统
# 成功分配 sda3 空间到 ubuntu--vg-ubuntu--lv
sudo resize2fs /dev/mapper/ubuntu--vg-ubuntu--lv

# 如果使用xfs文件系统，使用：
# sudo xfs_growfs /
```

## 8. 验证结果
```bash
df -h
lsblk
```

## 完整命令序列（通常情况）：
```bash
# 检查当前状态
sudo fdisk -l /dev/sda
sudo pvs
sudo vgs
sudo lvs

# 扩展流程
sudo parted /dev/sda resizepart 3 100%
sudo partprobe /dev/sda
sudo pvresize /dev/sda3
sudo lvextend -l +100%FREE /dev/mapper/ubuntu--vg-ubuntu--lv
sudo resize2fs /dev/mapper/ubuntu--vg-ubuntu--lv

# 验证
df -h
```

执行这些命令后，您的根分区应该显示接近500GB的可用空间。如果遇到任何问题，请先备份重要数据。